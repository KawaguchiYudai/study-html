<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <title>notifier_test</title>
</head>

<style>
    * {
        margin: 0px;
        padding: 0px;
    }

    /*body {
        background-color: #000000;
    }*/
</style>

<script>
    var n;
    //起動時
    window.onload = () => {
        n = new notifier();
        n.posY = 200;
        n.maxCount = 5;
        n.time = 5000;
        n.marginVertical = 5;
        n.marginHorizontal = 3;
        n.color = '#00f';
        n.alpha = 0.8;
    };
    class stickers {
        #active = false;

        #posX = 0;
        #posY = 0;
        #width = 100;
        #height = 25;

        #time = 5000;
        #moveTime = 1000;

        #popDirection = 'right';

        #canvas;
        #context;
        #timeout;
        constructor(width, height, x, y) {
            this.#width = width;
            this.#height = height;
            this.#posX = x;
            this.#posY = y;

            this.#canvas = document.createElement("canvas");
            this.#canvas.width = this.#width;
            this.#canvas.height = this.#height;
            this.#canvas.style.position = 'absolute';
            this.#canvas.style.overflow = 'hidden';
            this.#canvas.style.top = `${this.#posY}px`;
            this.#canvas.style.left = `${this.#posX}px`;
            document.body.appendChild(this.#canvas);

            this.#context = this.#canvas.getContext('2d');
        }
        on(draw = (ctx, width, height, x, y) => { }) {
            this.#active = true;

            let interval;
            switch (this.#popDirection) {
                case 'right':
                    const deltaX = - this.#posX / this.moveTime;
                    const date = new Date().getTime();
                    interval = setInterval(() => {
                        const deltaTime = (new Date().getTime()) - date;
                        if (deltaTime >= this.moveTime) {
                            clearInterval(interval);
                            draw(this.#context, this.#width, this.#height, 0, 0);
                            return;
                        }
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        draw(this.#context, this.#width, this.#height, deltaX, 0);
                    }, this.#moveTime);
                    break;
            }

            this.#timeout = setTimeout(() => { this.out(); }, this.time);
        }
        out() {
            this.#active = false;

        }
        move(x, y) {
            const deltaX = (x !== 0) ? x / this.moveTime : 0;
            const deltaY = (y !== 0) ? y / this.moveTime : 0;
            const date = new Date().getTime();
            const interval = setInterval(() => {
                const deltaTime = (new Date().getTime()) - date;
                if (deltaTime >= this.moveTime) {
                    clearInterval(interval);
                    this.#posY += y;
                    this.#posX += x;
                    this.#canvas.style.top = `${this.#posY}px`;
                    this.#canvas.style.left = `${this.#posX}px`;
                    return;
                }
                this.#canvas.style.top = `${this.#posY + deltaY * deltaTime}px`;
                this.#canvas.style.left = `${this.#posX + deltaX * deltaTime}px`;
                return;
            }, 30 / 1000)
        }

        delete() {
            this.#canvas.remove();
        }
    }

    class notifier {
        #posX = 0;
        set posX(x) {
            this.#posX = x;
        }
        #posY = 0;
        set posY(y) {
            this.#posY = y;
        }

        #width = 100;
        set width(width) {
            this.#width = width;
        }
        #height = 25;
        set height(height) {
            this.#height = height;
        }

        #marginVertical = 0;
        set marginVertical(vertical) {
            this.#marginVertical = vertical;
        }
        #marginHorizontal = 0;
        set marginHorizontal(horizontal) {
            this.#marginHorizontal = horizontal;
        }

        #color = '#FFF';
        set color(color) {
            this.#color = color;
        }
        #alpha = 1;
        set alpha(alpha) {
            this.#alpha = alpha;
        }

        #textColor = '#FFF';
        set textColor(color) {
            this.#textColor = color;
        }
        #textAlpha = 1;
        set textAlpha(alpha) {
            this.#textAlpha = alpha;
        }
        #textMarginVertical = 1;
        set textMarginVertical(vertical) {
            this.#textMarginVertical = vertical;
        }
        #textMarginHorizontal = 1;
        set textMarginHorizontal(horizontal) {
            this.#textMarginHorizontal = horizontal;
        }

        #time = 1000;
        set time(time) {
            this.#time = time;
        }
        #maxCount = 1;
        set maxCount(count) {
            this.#maxCount = count;
        }

        #count = 0;
        #canvas;
        #timeout;
        #stickers;
        push(text) {
            let a = new stickers(this.#width, this.#height, this.#posX, this.#posY);
            a.on(function (ctx, width, height, x, y) {
                ctx.fillStyle = this.#color;
                ctx.globalAlpha = this.#alpha;
                ctx.fillRect(x, y, width, height);

                ctx.font = `${height - this.#textMarginVertical * 2}px serif`;
                ctx.fillStyle = this.#textColor;
                ctx.globalAlpha = this.#textAlpha;
                ctx.fillText(
                    text,
                    x + this.#textMarginHorizontal,
                    y + height - this.#textMarginVertical,
                    width - this.#textMarginHorizontal * 2
                );
            })
            return;
            if (this.#count === this.#maxCount) return;
            if (this.#count == 0) {
                this.#canvas = document.createElement("canvas");
                this.#canvas.width = this.#width + this.#marginHorizontal;
                this.#canvas.height = this.#height * this.#maxCount + this.#marginVertical * (this.#maxCount - 1);
                this.#canvas.style.position = 'absolute';
                this.#canvas.style.overflow = 'hidden';
                this.#canvas.style.top = `${this.#posY}px`;
                this.#canvas.style.left = `${this.#posX}px`;
                document.body.appendChild(this.#canvas);
            }
            (ctx, width, height, x, y) => {
                ctx.fillStyle = this.#color;
                ctx.globalAlpha = this.#alpha;
                ctx.fillRect(x, y, width, height);

                ctx.font = `${height - this.#textMarginVertical * 2}px serif`;
                ctx.fillStyle = this.#textColor;
                ctx.globalAlpha = this.#textAlpha;
                ctx.fillText(
                    text,
                    x + this.#textMarginHorizontal,
                    y + height - this.#textMarginVertical,
                    width - this.#textMarginHorizontal * 2
                );
            }

            let context = this.#canvas.getContext('2d');
            context.fillStyle = this.#color;
            context.globalAlpha = this.#alpha;
            const rectPosX = this.#marginHorizontal;
            const rectPosY = this.#height * this.#count + this.#marginVertical * this.#count;
            context.fillRect(rectPosX, rectPosY, this.#width, this.#height);

            context.font = `${this.#height - 2}px serif`;
            context.fillStyle = this.#textColor;
            context.globalAlpha = this.#textAlpha;
            const textPosX = this.#marginHorizontal + this.#textMarginHorizontal * 2;
            const textPosY = this.#height * (this.#count + 1) + this.#marginVertical * this.#count - this.#textMarginVertical * 2;
            context.fillText(text, textPosX, textPosY, this.#width - this.#textMarginHorizontal * 2);
            this.#count++;

            setTimeout(() => { this.#count--; }, this.#time);

            if (this.#timeout != undefined) clearTimeout(this.#timeout);
            this.#timeout = setTimeout(() => { this.#canvas.remove(); }, this.#time)
        }
    }
</script>

<body>
    <a href="#" onclick="n.push('ハムスター');">確認</a>
    <canvas height="0" width="=100"> </canvas>
</body>

</html>